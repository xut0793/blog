# Vue 应用测试

WWHD

## What 什么是测试

应用程序测试是指检查应用程序运行过程是否正常.

测试的方法主要有两种:手动测试和自动化测试

- 手动测试是通过测试人员与应用程序的交互操作来检查其是否正常运行的方法.
- 自动化测试是编写测试代码,利用计算机来检查应用程序是否正常运行的方法.简单说,就是利用额外的代码来检查被测软件功能.

在前端领域,自动化测试的三种测试类型,也称为前端测试套件:单元测试/快照测试/端到端测试

- 单元测试: 是对应用程序最小单元运行测试的过程.通常,测试的最小单元是**函数**,但在现代流行的组件化前端项目工程中,**组件**也被视为测试单元.
  - 优点:
    - 测试运行速度快
    - 有相当于程序文档的功能,帮助新手快速了解功能需求.
  - 缺点:
    - 重构代码困难,将一个已经具备完整单元测试的复杂功能拆分为两个单独的功能,需要在更改代码的同时更改相应的单元测试.
    - 只确保单元代码自身行为符合预期,但无法保证各单元之间交互是否正常.这就是为什么需要用到端到端测试的原因.
- 快照测试: 相当于找不同游戏,会给运行中的程序拍一张图片,并将与以前保存的图片进行比较.如果图像不同,则测试失败.
  - Jest 快照测试可以对 JS 中任何可序列化的值进行对比.
- 端到端测试: 相当于自动执行的手动测试,从用户的视角通过浏览器或模拟浏览器软件自动检查应用程序是否正常工作.

  - 优点:减少人工操作
  - 缺点:
    - 端到端测试运行不够快:受限于浏览器启动时间,网络请求响应时间等.
    - 调试困难,需要按打开浏览器逐步按用户操作来重现问题
    - flaky 测试,即使用应用程序正常运行,测试仍然可能频繁失败,可能原因是代码因为某些 API,或请求超时等而导致失败.

  > 可序列化表示任何可以转换为字符串然后返回值的代码.

## 前端测试金字塔

- 60%单元测试
- 30%快照测试
- 10%端到端测试

## 测试驱动开发 TDD

测试驱动开发(TDD)是一种在编写源代码之前先编写测试代码的工作流程.

即在组件开发中在编写组件代码之前,先编写能够确保组件正常运行的测试代码.

**红/绿/重构**是一种很流行的 TDD 方法.红代表编写一个不能通过的测试,然后修改代码让测试通过变绿,最后通过重构增强代码可读性.

严苛遵守 TDD(在编写源代码之前编写好所有的测试代码)会严重减缓开发速度,所以只要编写可节省时间的,有价值的测试代码就可以,编写先后顺序无关紧要.

作者常用的 Vue 组件开发步骤:

1. 确定需要编写组件需求
1. 为每个组件编写单元测试和源代码,先后顺序自行决定
1. 调整组件的样式
1. 为已完成的组件添加快照测试
1. 在浏览器中手动测试代码
1. 视需要编写端到端测试

## 100% 代码覆盖率是谬误

代码覆盖率是度量自动化测试运行代码库代码行数的一个指标.

- 100% 代码覆盖率意味着执行测试期间每行代码都会被运行
- 0% 代码覆盖率意味着未执行任何代码

不必执着于让应用程序实现 100% 代码覆盖率,它会让你像拧干湿毛巾的最后一滴水一样辛苦,只需要完成应用的核心功能测试即可.

## 组件的单元测试

对组件确定编写哪些单元测试是非常重要的,如果为组件的每个属性都编写测试,将会创建出一个低效的,减缓开发速度的测试套件.

能够帮助我们决定如何测试组件的一种方法是遵循使用**组件契约**的概念:**提供正确的输入,该组件将产生约定的输出**.

Vue 组件常见的输入:

- 组件中的 props
- 用户操作(如点击按钮)
- 子组件事件确发
- Vuex Store 中的数据

常见的输出:

- 渲染函数生成的 DOM 节点
- 发射出的事件
- 外部函数的调用

## 可用性测试(sanity test)

搭建测试系统的第一步是编写一个简单的测试来检查系统是否设置正常,这个测试就称为可用性测试(sanity test).

## vue 应用测试摘录

> `<<vue.js 应用测试>>`

1. 测试是有关输入和输出的，在测试中，你提供输入，接收输出，并断言输出是否正确的过程。P40
1. 端到端测试是利用程序自动执行的那些原本手动测试的内容。它并不是一种新的测试代码的方法，只是利用程序加快了手动测试的执行速度。而单元测试是一种不同于手动测试代码的新方法。P6
1. 单元测试是对应用程序最小的部分（单元）运行测试的过程。通常应用程序最小单元是函数，在现代组件化前端开发中，组件也是被测单元。P6
1. 快照测试类型于“找不同”的游戏。快照测试会给运行中的应用程序拍一张图片，并将其与以前保存的图片进行比较，如果图像有什么不同，则测试失败。P7
1. 传统快照测试是在浏览器中启动应用程序并获取渲染页面的屏幕截图进行比较，jest 快照测试可以对 javascript 中任何可序列化的值进行比较。P7
1. 前端应用程序测试套件的组成的合理比较：单元测试 60%，快照测试 30%，端到端测试 10%。P8
1. 可用性测试(sanity test)：是编写一个简单的测试来检查搭建的测试环境是否可用。P24
1. describe 函数将一组单元测试定义为一个测试套件（suites)。使用 describe 函数组织单元测试，就像用分隔板对文件柜里的文件进行隔离分类一样，能够将文件归档到正常的类型，井井有条，但应该避免过量的嵌套 describe 函数，让人迷失。P29
1. 需求是从用户的视角对应用程序进行的**模糊描述**。P41
1. 创建组件测试规范的步骤：拿到需求 =》 明确需求（高级规范） =》 分解成组件规范 P41
   - 多方就需求达成一致
   - 明确需求：回答有关细节的问题，以得到高级规范与设计，如 UI 图
   - 将 UI 设计的组件结构进行拆解成组件单位
   - 将明确的需求，即得到的高级规范分解成组件规范
1. 一个好的单元测试要有一个富有表达力的断言 P49
1. 耦合是指代码模块之间的相互依赖。P56

